# 一些特性，细节，问题

mysql 数据库每页大小为16kb





### 数据库SQL优化

1. 对查询进行优化，要尽量避免全表扫描，考虑在 where 及 order by 涉及的列上建立索引
2. 应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描
3. 应尽量避免在 where 子句中使用 != 或 <> 操作符，否则将引擎放弃使用索引而进行全表扫描
4. 应尽量避免在 where 子句中使用 or 来连接条件，如果一个字段有索引，一个字段没有索引，将导致引擎放弃使用索引而进行全表扫描。如：select id from t where num=10 or Name = 'admin'
5. 下面的查询也将导致全表扫描select id from t where name like ‘%abc%’   若要提高效率，可以考虑全文检索。
6. 尽量避免在where子句中对字段模糊匹配，函数操作
7. 尽量避免在where子句中的=左边进行函数，算数运算，或其他表达式运算，如：select id from t where num/2 = 100应改为：select id from t where num = 100*29. 
8. 一个表的索引最好不要超过6个，因为索引提高了查询效率，但是减弱了插入和更新的效率
9. 在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。
10. 如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定

索引数据结构为什么采用B+树     为了尽量减少I/O操作

### **mysql表删一半数据，表空间会变小吗****

不会，mysql执行delete操作后，存储在硬盘上的数据没有被删除，只不过在记录行上做了逻辑删除，即通过删除标识位实现。

因为移除它们之后，很多其他的记录需要在磁盘上重新排列，这样会消耗大量的性能，比如如果是一张大表，存在索引，删除了其中一行，那么整个索引结构就会发生变化，随之而来的是要改变索引结构，必将带来磁盘IO，大家都知道磁盘IO是很浪费性能的。所有被删除的记录都会组成一个垃圾链表，这个链表中记录占用的空间叫做可重用空间，之后有新记录插入的时候可能把已删除记录占用的空间覆盖掉。

### 索引的优缺点   

**优点：**    

1. 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。     

2. 可以大大加快数据的检索速度，这也是创建索引的最主要的原因。     

3. 可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。    

4. 在使用分组和排序子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。    

5. 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。

 **缺点：**    

1. 创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。     
2. 索引需要占物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果要建立聚簇索引，那么需要的空间就会更大。     
3. 当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。索引是建立在数据库表中的某些列的上面。在创建索引的时候，应该考虑在哪些列上可以创建索引，在哪些列上不能创建索引。

 **哪些字段适合建索引**    

1. 在经常需要搜索的列上，可以加快搜索的速度；     
2. 在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构；    
3. 在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度；    
4. 在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的；     
5. 在经常需要排序的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间；     
6. 在经常使用在WHERE子句中的列上面创建索引，加快条件的判断速度。 

**哪些字段不适合建索引**     

1.对于那些在查询中很少使用或者参考的列不应该创建索引。这是因为，既然这些列很少使用到，因此有索引或者无索引，并不能提高查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。

### mongodb和Mysql的区别

**mysql**

1、在不同的引擎上有不同的存储方式。
 2、查询语句是使用传统的sql语句，拥有较为成熟的体系，成熟度很高。
 3、开源数据库的份额在不断增加，mysql的份额页在持续增长。
 4、**缺点就是在海量数据处理的时候效率会显著变慢**。

**mongodb**

1、存储方式：虚拟内存+持久化。
 2、查询语句：是独特的MongoDB的查询方式。
 3、适合场景：事件的记录，内容管理或者博客平台等等。
 4、架构特点：可以通过副本集，以及分片来实现高可用。
 5、数据处理：**数据是存储在硬盘上的**，只不过需要经常读取的数据会被加载到内存中，将数据存储在物理内存中，从而达到高速读写。
 6、成熟度与广泛度：新兴数据库，成熟度较低，Nosql数据库中最为接近关系型数据库，比较完善的DB之一，适用人群不断在增长。

### 什么是ORM

是一种用于实现面向对象编程语言里不同类型数据之间转换的技术.，ORM解决的主要问题是对象关系的映射.我们在进行数据库操作的时候，通过ORM可以不用写一些专用的函数来进行的对数据的处理

ORM技术特点：
　　1.提高了开发效率.由于ORM可以自动对Entity对象与数据库中的Table进行字段与属性的映射,所以我们实际可能已经不需要一个专用的、庞大的数据访问层.
　　2.ORM提供了对数据库的映射,不用sql直接编码,能够像操作对象一样从数据库获取数据.

### 最左前缀原则

建立一个联合索引，对于索引中的字段，mysql会一直向右匹配直到遇到**范围查询**(>、<、between、like)就停止匹配，比如a = 1 and b = 2 and c > 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。

在检索数据时从联合索引的最左边开始匹配。所以当我们创建一个联合索引的时候，如(key1,key2,key3)，相当于创建了（key1）、(key1,key2)和(key1,key2,key3)三个索引，这就是最左匹配原则

