#### 接口性能优化思路



##### 梳理代码，耗时情况，性能分析

python内置性能分析工具：`Cprofile`，标准库`timeit`

地址：[The Python Profilers — Python 3.12.1 documentation --- Python 分析器 — Python 3.12.1 文档](https://docs.python.org/3/library/profile.html) 

```python
# 监控一段代码的性能
import cProfile, pstats, io
from pstats import SortKey
pr = cProfile.Profile()
pr.enable()
# ... do something ... 需要监控的执行内容
pr.disable()
s = io.StringIO()
sortby = SortKey.CUMULATIVE
ps = pstats.Stats(pr, stream=s).sort_stats(sortby) #  创建一个Stats对象，该对象用于加载先前保存的性能分析结果文件（通常是通过cProfile模块生成的）
ps.print_stats() # 删除文件路径信息，以便更清晰地显示模块和函数的名称。
pr.dump_stats("profile.prof") # 将分析内容输出到文件，可以提供给其他工具生成火焰图等图表
print(s.getvalue())
```

ncalls （for the number of calls.）：用于调用次数。
tottime ：指的是函数本身的运行时间，扣除了子函数的运行时间
percall 
cumtime ：指的是函数的累计运行时间，包含了子函数的运行时间
percall 每次调用
filename:lineno(function) ：文件名

```shell
# 作为模块导入
import timeit

def my_function():
    # Your code here

# 测试 my_function 的执行时间
time_taken = timeit.timeit(my_function, number=1000)
print(f"Time taken: {time_taken} seconds")

# 作为命令行工具
python -m timeit "print('Hello, World!')"
```

py-spy 性能分析工具

参考: [Python性能分析工具py-spy原理用法解析-CSDN博客](https://blog.csdn.net/liming89/article/details/109663846) 



