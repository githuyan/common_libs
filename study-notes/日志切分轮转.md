#### 日志切分轮转

##### python自带的日志管理工具

```python
# 按天轮转日志文件

import logging
from logging.handlers import TimedRotatingFileHandler
import time

logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO) 

# 定义一个1天轮转的日志处理器
handler = TimedRotatingFileHandler(filename="logs/log", when="D", interval=1, backupCount=7)

formatter = logging.Formatter('%(asctime)s %(message)s')
handler.setFormatter(formatter)

logger.addHandler(handler)

while True:
    logger.info("This is a log message")
    time.sleep(2)
```



##### linux日志轮转工具：logrotate

logrotate是Linux系统中的一个日志文件管理工具,它可以用来自动轮转日志文件,压缩并删除旧的日志文件。

logrotate的工作原理是:

1. 根据配置文件(/etc/logrotate.conf和/etc/logrotate.d/*.conf)设置的规则,周期性地轮转日志文件。
2. 将日志文件打包压缩为gz或zip文件,这样可以节省磁盘空间。
3. 删除过期的日志文件,保证日志文件不会占用太多磁盘空间。
4. 可以为不同的日志文件设置不同的轮转周期,如天、周、月等。
5. 轮转时可以发送信号通知相关程序重新打开日志文件。

logrotate的配置文件包含了轮转规则,如轮转周期、日志文件的路径、压缩选项等。

使用logrotate的好处是:

- 自动轮转日志,维护 Logs
- 压缩日志节省磁盘空间
- 可以自定义日志处理规则
- 轮转日志不会影响程序运行

综上,logrotate是Linux环境下一个非常有用的日志文件管理工具,可以自动定期轮转、压缩、删除日志文件,十分方便和实用。它被广泛应用于各种服务器程序的日志管理中



使用TimedRotatingFileHandler和logrotate这两种日志轮转方式,各有优缺点:

TimedRotatingFileHandler:

优点:

- 作为logging模块的一部分,使用方便,可以通过Python代码控制
- 可以自定义轮转频率和保留日志个数
- 基于代码,可以增加灵活的日志处理逻辑

缺点:

- 依赖于应用程序,如果应用退出就无法轮转
- 没有日志压缩功能

logrotate:

优点:

- 不依赖应用程序,可以定时自动轮转日志
- 提供日志压缩功能,节省空间
- 作为独立服务,可以统一管理所有的日志文件
- 轮转策略可以通过配置文件修改

缺点:

- 需要修改配置文件来改变轮转方式,不如代码方式灵活
- 没有直接将日志输入到日志管理系统或监控系统的功能

总结:

TimedRotatingFileHandler更适合需要代码级控制和定制的场景,而logrotate更通用,可以管理多个应用的日志,但不如前者灵活。

所以,二者可以结合使用,在应用里使用TimedRotatingFileHandler处理日志,并用logrotate统一轮转日志文件。这可以发挥两者的优势,既可以方便处理应用日志,也可以统一管理服务器的所有日志。